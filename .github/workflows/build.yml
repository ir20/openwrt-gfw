on:
  push:
      branches:
        - master
  schedule:
      - cron:  '0 0 * * 0'
jobs:
  build:
    name: Build
    runs-on: ubuntu-18.04
    strategy:
      fail-fast: false
      matrix:
        args: ['ARCH=apm821xx-sata URL=https://downloads.openwrt.org/releases/19.07.0/targets/apm821xx/sata/openwrt-sdk-19.07.0-apm821xx-sata_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=pistachio-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/pistachio/generic/openwrt-sdk-19.07.0-pistachio_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=x86-legacy URL=https://downloads.openwrt.org/releases/19.07.0/targets/x86/legacy/openwrt-sdk-19.07.0-x86-legacy_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ramips-rt3883 URL=https://downloads.openwrt.org/releases/19.07.0/targets/ramips/rt3883/openwrt-sdk-19.07.0-ramips-rt3883_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=zynq-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/zynq/generic/openwrt-sdk-19.07.0-zynq_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=x86-geode URL=https://downloads.openwrt.org/releases/19.07.0/targets/x86/geode/openwrt-sdk-19.07.0-x86-geode_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=octeontx-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/octeontx/generic/openwrt-sdk-19.07.0-octeontx_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=sunxi-cortexa8 URL=https://downloads.openwrt.org/releases/19.07.0/targets/sunxi/cortexa8/openwrt-sdk-19.07.0-sunxi-cortexa8_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=tegra-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/tegra/generic/openwrt-sdk-19.07.0-tegra_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=mediatek-mt7622 URL=https://downloads.openwrt.org/releases/19.07.0/targets/mediatek/mt7622/openwrt-sdk-19.07.0-mediatek-mt7622_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=mediatek-mt7623 URL=https://downloads.openwrt.org/releases/19.07.0/targets/mediatek/mt7623/openwrt-sdk-19.07.0-mediatek-mt7623_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=sunxi-cortexa7 URL=https://downloads.openwrt.org/releases/19.07.0/targets/sunxi/cortexa7/openwrt-sdk-19.07.0-sunxi-cortexa7_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=mxs-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/mxs/generic/openwrt-sdk-19.07.0-mxs_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=mpc85xx-p2020 URL=https://downloads.openwrt.org/releases/19.07.0/targets/mpc85xx/p2020/openwrt-sdk-19.07.0-mpc85xx-p2020_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=octeon-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/octeon/generic/openwrt-sdk-19.07.0-octeon_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=oxnas-ox820 URL=https://downloads.openwrt.org/releases/19.07.0/targets/oxnas/ox820/openwrt-sdk-19.07.0-oxnas-ox820_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=apm821xx-nand URL=https://downloads.openwrt.org/releases/19.07.0/targets/apm821xx/nand/openwrt-sdk-19.07.0-apm821xx-nand_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=layerscape-armv8_64b URL=https://downloads.openwrt.org/releases/19.07.0/targets/layerscape/armv8_64b/openwrt-sdk-19.07.0-layerscape-armv8_64b_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=malta-be URL=https://downloads.openwrt.org/releases/19.07.0/targets/malta/be/openwrt-sdk-19.07.0-malta-be_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=omap-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/omap/generic/openwrt-sdk-19.07.0-omap_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=layerscape-armv7 URL=https://downloads.openwrt.org/releases/19.07.0/targets/layerscape/armv7/openwrt-sdk-19.07.0-layerscape-armv7_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=mpc85xx-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/mpc85xx/generic/openwrt-sdk-19.07.0-mpc85xx-generic_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=mvebu-cortexa72 URL=https://downloads.openwrt.org/releases/19.07.0/targets/mvebu/cortexa72/openwrt-sdk-19.07.0-mvebu-cortexa72_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=mpc85xx-p1020 URL=https://downloads.openwrt.org/releases/19.07.0/targets/mpc85xx/p1020/openwrt-sdk-19.07.0-mpc85xx-p1020_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=mvebu-cortexa53 URL=https://downloads.openwrt.org/releases/19.07.0/targets/mvebu/cortexa53/openwrt-sdk-19.07.0-mvebu-cortexa53_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=samsung-s5pv210 URL=https://downloads.openwrt.org/releases/19.07.0/targets/samsung/s5pv210/openwrt-sdk-19.07.0-samsung-s5pv210_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=x86-64 URL=https://downloads.openwrt.org/releases/19.07.0/targets/x86/64/openwrt-sdk-19.07.0-x86-64_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=x86-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/x86/generic/openwrt-sdk-19.07.0-x86-generic_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ramips-rt288x URL=https://downloads.openwrt.org/releases/19.07.0/targets/ramips/rt288x/openwrt-sdk-19.07.0-ramips-rt288x_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=rb532-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/rb532/generic/openwrt-sdk-19.07.0-rb532_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=mvebu-cortexa9 URL=https://downloads.openwrt.org/releases/19.07.0/targets/mvebu/cortexa9/openwrt-sdk-19.07.0-mvebu-cortexa9_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=ramips-mt7621 URL=https://downloads.openwrt.org/releases/19.07.0/targets/ramips/mt7621/openwrt-sdk-19.07.0-ramips-mt7621_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ramips-rt305x URL=https://downloads.openwrt.org/releases/19.07.0/targets/ramips/rt305x/openwrt-sdk-19.07.0-ramips-rt305x_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ramips-mt76x8 URL=https://downloads.openwrt.org/releases/19.07.0/targets/ramips/mt76x8/openwrt-sdk-19.07.0-ramips-mt76x8_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=sunxi-cortexa53 URL=https://downloads.openwrt.org/releases/19.07.0/targets/sunxi/cortexa53/openwrt-sdk-19.07.0-sunxi-cortexa53_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ramips-mt7620 URL=https://downloads.openwrt.org/releases/19.07.0/targets/ramips/mt7620/openwrt-sdk-19.07.0-ramips-mt7620_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=lantiq-xway_legacy URL=https://downloads.openwrt.org/releases/19.07.0/targets/lantiq/xway_legacy/openwrt-sdk-19.07.0-lantiq-xway_legacy_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=lantiq-xway URL=https://downloads.openwrt.org/releases/19.07.0/targets/lantiq/xway/openwrt-sdk-19.07.0-lantiq-xway_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ipq806x-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/ipq806x/generic/openwrt-sdk-19.07.0-ipq806x-generic_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=lantiq-falcon URL=https://downloads.openwrt.org/releases/19.07.0/targets/lantiq/falcon/openwrt-sdk-19.07.0-lantiq-falcon_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ipq40xx-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/ipq40xx/generic/openwrt-sdk-19.07.0-ipq40xx-generic_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=cns3xxx-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/cns3xxx/generic/openwrt-sdk-19.07.0-cns3xxx_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=brcm47xx-mips74k URL=https://downloads.openwrt.org/releases/19.07.0/targets/brcm47xx/mips74k/openwrt-sdk-19.07.0-brcm47xx-mips74k_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=brcm2708-bcm2710 URL=https://downloads.openwrt.org/releases/19.07.0/targets/brcm2708/bcm2710/openwrt-sdk-19.07.0-brcm2708-bcm2710_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ath79-nand URL=https://downloads.openwrt.org/releases/19.07.0/targets/ath79/nand/openwrt-sdk-19.07.0-ath79-nand_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=brcm47xx-legacy URL=https://downloads.openwrt.org/releases/19.07.0/targets/brcm47xx/legacy/openwrt-sdk-19.07.0-brcm47xx-legacy_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=brcm2708-bcm2709 URL=https://downloads.openwrt.org/releases/19.07.0/targets/brcm2708/bcm2709/openwrt-sdk-19.07.0-brcm2708-bcm2709_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=ath25-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/ath25/generic/openwrt-sdk-19.07.0-ath25_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=brcm2708-bcm2708 URL=https://downloads.openwrt.org/releases/19.07.0/targets/brcm2708/bcm2708/openwrt-sdk-19.07.0-brcm2708-bcm2708_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=ath79-tiny URL=https://downloads.openwrt.org/releases/19.07.0/targets/ath79/tiny/openwrt-sdk-19.07.0-ath79-tiny_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=bcm53xx-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/bcm53xx/generic/openwrt-sdk-19.07.0-bcm53xx_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=imx6-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/imx6/generic/openwrt-sdk-19.07.0-imx6_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=ath79-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/ath79/generic/openwrt-sdk-19.07.0-ath79-generic_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=kirkwood-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/kirkwood/generic/openwrt-sdk-19.07.0-kirkwood_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=brcm47xx-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/brcm47xx/generic/openwrt-sdk-19.07.0-brcm47xx-generic_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=gemini-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/gemini/generic/openwrt-sdk-19.07.0-gemini_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=brcm63xx-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/brcm63xx/generic/openwrt-sdk-19.07.0-brcm63xx-generic_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=brcm63xx-smp URL=https://downloads.openwrt.org/releases/19.07.0/targets/brcm63xx/smp/openwrt-sdk-19.07.0-brcm63xx-smp_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=lantiq-xrx200 URL=https://downloads.openwrt.org/releases/19.07.0/targets/lantiq/xrx200/openwrt-sdk-19.07.0-lantiq-xrx200_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=lantiq-ase URL=https://downloads.openwrt.org/releases/19.07.0/targets/lantiq/ase/openwrt-sdk-19.07.0-lantiq-ase_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=armvirt-64 URL=https://downloads.openwrt.org/releases/19.07.0/targets/armvirt/64/openwrt-sdk-19.07.0-armvirt-64_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=at91-sama5 URL=https://downloads.openwrt.org/releases/19.07.0/targets/at91/sama5/openwrt-sdk-19.07.0-at91-sama5_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=armvirt-32 URL=https://downloads.openwrt.org/releases/19.07.0/targets/armvirt/32/openwrt-sdk-19.07.0-armvirt-32_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=at91-sam9x URL=https://downloads.openwrt.org/releases/19.07.0/targets/at91/sam9x/openwrt-sdk-19.07.0-at91-sam9x_gcc-7.5.0_musl_eabi.Linux-x86_64.tar.xz', 'ARCH=ar71xx-tiny URL=https://downloads.openwrt.org/releases/19.07.0/targets/ar71xx/tiny/openwrt-sdk-19.07.0-ar71xx-tiny_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ar71xx-nand URL=https://downloads.openwrt.org/releases/19.07.0/targets/ar71xx/nand/openwrt-sdk-19.07.0-ar71xx-nand_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=ar71xx-mikrotik URL=https://downloads.openwrt.org/releases/19.07.0/targets/ar71xx/mikrotik/openwrt-sdk-19.07.0-ar71xx-mikrotik_gcc-7.5.0_musl.Linux-x86_64.tar.xz', 'ARCH=arc770-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/arc770/generic/openwrt-sdk-19.07.0-arc770-generic_gcc-8.3.0_uClibc.Linux-x86_64.tar.xz', 'ARCH=archs38-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/archs38/generic/openwrt-sdk-19.07.0-archs38-generic_gcc-8.3.0_uClibc.Linux-x86_64.tar.xz', 'ARCH=ar71xx-generic URL=https://downloads.openwrt.org/releases/19.07.0/targets/ar71xx/generic/openwrt-sdk-19.07.0-ar71xx-generic_gcc-7.5.0_musl.Linux-x86_64.tar.xz']
    steps:
    - uses: actions/checkout@v2
    - name: login
      run: echo "${{ secrets.docker_password }}" | docker login -u "${{ secrets.docker_username }}" --password-stdin
    - name: build && push
      run: |
        ${{ matrix.args }}
        docker build --build-arg URL=$URL -t ${{ secrets.docker_repo }}:$ARCH . && \
        docker push ${{ secrets.docker_repo }}:$ARCH && \
        docker cp $(docker run -d ${{ secrets.docker_repo }}:$ARCH):/output .
        mkdir output/$ARCH && \
        mv output/*.ipk $ARCH
    - name: Upload artifact
      uses: actions/upload-artifact@v1.0.0
      with:
        name: ipks_all
        path: output
